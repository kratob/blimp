(function(){angular.module("blimp",["ngAnimate","ngRoute","material.components.button","material.components.content","material.components.icon","material.components.input","material.components.progressCircular","material.components.toolbar","material.components.whiteframe","infinite-scroll"]).config(["$mdThemingProvider",function(a){return a.theme("default").primaryPalette("brown").accentPalette("amber")}])}).call(this),function(){angular.module("blimp").config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl",controllerAs:"dashboard"}).when("/:channelName",{templateUrl:"views/channel.html",controller:"ChannelCtrl",controllerAs:"channel"}).otherwise({redirectTo:"/"})}])}.call(this),function(){angular.module("blimp").controller("ChannelCtrl",["$routeParams","Channel","Layout",function(a,b,c){var d,e,f;this.channelName=a.channelName,this.results=void 0,this.loading=!0,this.query="",d=void 0,f=void 0,e=new b(this.channelName),c.title=this.channelName,e.update().then(function(a){return function(){return d=e.highlights,a.filter(),a.loading=!1}}(this),function(a){return function(b){return a.error=b,a.loading=!1}}(this)),this.filter=function(){var a;return a=this.query.toLowerCase(),f=""===a?d:_.filter(d,function(b){return b.matches(a)}),this.highlights=[],this.addBatch()},this.addBatch=function(){var a;if(null!=f)return a=this.highlights.length+20,this.highlights=f.slice(0,+a+1||9e9)},this.goTo=function(a){return window.location.href=a.url}}])}.call(this),function(){angular.module("blimp").factory("Channel",["LsCache","TwitchApi","Highlight","$q","$timeout",function(a,b,c,d,e){var f,g,h,i;return f=100,i=10,h=120,g=function(){function g(a){this.channelName=a,this.highlights=[],this._allReadyDeferred=d.defer(),this.allReady=this._allReadyDeferred.promise}return g.prototype.update=function(){var a,b;return b=this._fetchHighlightsFromCache(),a=null!=b?i:f,this._fetchHighlights(a,0,b||[]),this.allReady},g.prototype._fetchHighlights=function(a,d,g){var h;return h=!1,(new b).fetchHighlights(this.channelName,a,d).then(function(b){return function(i){var j;return j=i.videos,_.each(j,function(a){var d;return d=new c(a),d.equals(g[0])?(b.highlights=b.highlights.concat(g),h=!0,e(function(){return b._doneFetching()}),!1):b.highlights.push(d)}),h?void 0:j.length===a?b._fetchHighlights(f,d+a,g):e(function(){return b._doneFetching()})}}(this),function(a){return function(b){return a.highlights=[],a.error=b,a._allReadyDeferred.reject(a.error)}}(this))},g.prototype._doneFetching=function(){return this._storeHighlightsToCache(this.highlights),this._allReadyDeferred.resolve()},g.prototype._fetchHighlightsFromCache=function(){var b;return b=a.get(this._cacheKey()),null!=b?c.wrapArray(b):void 0},g.prototype._storeHighlightsToCache=function(b){return a.set(this._cacheKey(),b,h)},g.prototype._cacheKey=function(){return"channel."+this.channelName+".highlights"},g}()}])}.call(this),function(){angular.module("blimp").factory("Highlight",function(){var a,b;return b=function(a){var b,c,d;return b=~~(a/3600),c=a%3600/60,c>=1&&(c=Math.round(c)),d=a%60,[b>0?""+b+" h":void 0,c>=1?""+c+" min":void 0,1>c&&0===b?""+d+" sec":void 0].join(" ")},a=function(){function a(a){_.extend(this,a),this._searchText=[this.title,this.description,this.game].join(" ").toLowerCase(),this.human_length=b(this.length)}return a.wrapArray=function(b){return _.map(b,function(b){return new a(b)})},a.prototype.equals=function(a){return a&&this._id===a._id},a.prototype.matches=function(a){return _.all(a.split(" "),function(a){return function(b){return _.includes(a._searchText,b)}}(this))},a}()})}.call(this),function(){angular.module("blimp").factory("LsCache",function(){return window.lscache})}.call(this),function(){angular.module("blimp").factory("TwitchApi",["$http","$q",function(a,b){var c,d;return c="https://api.twitch.tv/kraken",d=function(){function d(){}return d.prototype.fetchHighlights=function(d,e,f){return a.jsonp(""+c+"/channels/"+d+"/videos",{params:{limit:e,offset:f,callback:"JSON_CALLBACK"}}).then(function(a){return null!=a.data.error?b.reject(a.data.message):a.data})},d}()}])}.call(this),function(){angular.module("blimp").controller("DashboardCtrl",["$location",function(a){this.goTo=function(b){return null!=b&&""!==b?a.path("/"+b):void 0}}])}.call(this),function(){angular.module("blimp").controller("LayoutCtrl",["Layout",function(a){this.layout=a}])}.call(this),function(){angular.module("blimp").factory("Layout",function(){var a,b;return a="Twitch Highlight Search",b=function(){function b(){}return b.title=a,b}()})}.call(this),angular.module("blimp").run(["$templateCache",function(a){"use strict";a.put("views/channel.html",'<md-input-container class="search" md-no-float> <md-icon> search </md-icon> <input ng-change="channel.filter()" ng-model="channel.query" placeholder="Search" type="text"> </md-input-container> <div class="highlights" infinite-scroll-container="&quot;.content&quot;" infinite-scroll-distance="2" infinite-scroll="channel.addBatch()" ng-if="channel.highlights"> <div class="highlight" layout-sm="column" layout="row" ng-click="channel.goTo(highlight)" ng-repeat="highlight in channel.highlights"> <div class="highlight--teaser" flex-md="35"> <div class="highlight--image"> <img ng-src="{{ highlight.preview }}"> </div> </div> <div class="highlight--details" flex layout="column"> <h3 class="highlight--title md-title"> {{ highlight.title }} </h3> <div class="highlight--subtitle md-caption muted"> {{ highlight.recorded_at | date }} </div> <p class="highlight--description" flex> {{ highlight.description }} </p> <div class="highlight--info" layout="row"> <div class="highlight--info-part is-fixed"> <md-icon> schedule </md-icon> {{ highlight.human_length }} </div> <div class="highlight--info-part is-fixed"> <md-icon> visibility </md-icon> {{ highlight.views }} </div> <div class="highlight--info-part" ng-show="highlight.game"> <md-icon> tv </md-icon> {{ highlight.game }} </div> </div> </div> </div> </div> <p class="muted" ng-show="channel.highlights.length == 0"> No results. </p> <p ng-show="channel.error"> <md-icon class="md-warn"> error </md-icon> Twitch error: {{ channel.error }} </p> <div layout-align="center center" layout="row"> <div class="loading-indicator" ng-show="channel.loading"> <md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular> </div> </div>'),a.put("views/dashboard.html",'<form layout-align="start center" layout="row" ng-submit="dashboard.goTo(channelName)"> <md-input-container class="inline-input" flex-gt-sm="40" md-no-float> <input ng-change="channel.filter(query)" ng-model="channelName" placeholder="Channel name" type="text"> </md-input-container> <md-button class="md-primary md-raised"> Go! </md-button> </form>')}]);